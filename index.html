<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preventa LORD M (LMB)</title>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #2a2a2a;
            color: white;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        h1 {
            color: #FFD700;
            margin-top: 20px;
        }

        /* Responsiveness */
        @media (max-width: 768px) {
            h1 {
                font-size: 24px;
            }
            input, button, select {
                width: 90%;
                padding: 12px;
                font-size: 16px;
            }
        }

        /* Container Styles */
        div {
            margin: 20px 0;
        }

        /* Form Elements */
        input, select, button {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
            width: 80%;
            border-radius: 8px;
            border: 1px solid #FFD700;
            background-color: #333;
            color: white;
        }
        
        input[type="number"], input[type="text"] {
            width: 80%;
        }

        /* Button Styles */
        #buyButton {
            background-color: #FFD700;
            border: none;
            cursor: pointer;
            color: black;
        }

        /* Status Message */
        #statusMessage {
            margin-top: 20px;
            color: green;
            font-size: 18px;
        }

        /* Youtuber Section */
        #youtuberSection {
            margin-top: 40px;
            background-color: #444;
            padding: 20px;
            border-radius: 10px;
        }

        /* Timer Section */
        #countdownTimer {
            margin-top: 30px;
            font-size: 20px;
            color: #FFD700;
        }

        /* Social Media Share Section */
        #socialShare {
            margin-top: 20px;
            font-size: 18px;
        }

        /* Language Selection */
        #languageSelector {
            margin-top: 10px;
            font-size: 16px;
            background-color: #333;
            border: 1px solid #FFD700;
            color: white;
        }
    </style>
</head>
<body>
    <h1>Preventa de LORD M (LMB)</h1>

    <!-- Language Selector -->
    <div>
        <label for="languageSelector">Seleccionar idioma:</label>
        <select id="languageSelector">
            <option value="es">Español</option>
            <option value="en">English</option>
        </select>
    </div>

    <!-- Compra de Tokens -->
    <div>
        <label for="amountInput">Cantidad de USDT:</label>
        <input type="number" id="amountInput" placeholder="Cantidad en USDT" />
    </div>
    
    <div>
        <label for="referrerInput">Dirección de referido:</label>
        <input type="text" id="referrerInput" placeholder="Dirección de referido (opcional)" />
    </div>

    <div>
        <label for="networkSelect">Selecciona la Red:</label>
        <select id="networkSelect">
            <option value="ethereum">Ethereum</option>
            <option value="binance">Binance Smart Chain</option>
        </select>
    </div>

    <div>
        <label for="walletSelect">Selecciona la Wallet:</label>
        <select id="walletSelect">
            <option value="metamask">MetaMask</option>
            <option value="trustwallet">Trust Wallet</option>
        </select>
    </div>

    <button id="buyButton">Comprar Tokens</button>

    <div id="statusMessage"></div>

    <!-- Youtuber Section -->
    <div id="youtuberSection">
        <h3>¡Promociona LORD M y gana tokens!</h3>
        <p>Si eres Youtuber y deseas participar en nuestro programa de referidos, regístrate a continuación.</p>
        <form id="youtuberForm">
            <input type="text" id="youtuberChannel" placeholder="URL de tu canal de YouTube" />
            <button type="submit">Registrar Canal</button>
        </form>
        <div id="youtuberStatus"></div>
    </div>

    <!-- Temporizador de preventa -->
    <div id="countdownTimer">Tiempo restante para la etapa actual: <span id="timer"></span></div>

    <!-- Social Media Share Section -->
    <div id="socialShare">
        <p>¡Comparte la preventa de LORD M en tus redes sociales!</p>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https://example.com" target="_blank">Compartir en Facebook</a> |
        <a href="https://twitter.com/intent/tweet?url=https://example.com" target="_blank">Compartir en Twitter</a> |
        <a href="https://wa.me/?text=https://example.com" target="_blank">Compartir en WhatsApp</a>
    </div>

    <script>
        // ABI y dirección del contrato
        const abi = [
            {
                "constant": true,
                "inputs": [],
                "name": "getTokensSold",
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    {
                        "name": "amount",
                        "type": "uint256"
                    },
                    {
                        "name": "referrer",
                        "type": "address"
                    }
                ],
                "name": "buyTokens",
                "outputs": [],
                "payable": true,
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    {
                        "name": "amount",
                        "type": "uint256"
                    },
                    {
                        "name": "referrer",
                        "type": "address"
                    }
                ],
                "name": "buyTokensWithUSDT",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        // Dirección del contrato de la preventa
        const contractAddress = '0x3Bd2D68541F359BdFDd5F172A6d4BA60096e8814';

        let web3;
        let currentAccount;

        // Función para conectar a la red seleccionada
        async function connectToNetwork() {
            const selectedNetwork = document.getElementById('networkSelect').value;

            if (selectedNetwork === "ethereum") {
                web3 = new Web3(window.ethereum);
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                currentAccount = (await web3.eth.getAccounts())[0];
                console.log('Conectado a Ethereum');
            } else if (selectedNetwork === "binance") {
                web3 = new Web3(window.ethereum);  // Binance Smart Chain usa Web3 similar
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                currentAccount = (await web3.eth.getAccounts())[0];
                console.log('Conectado a Binance Smart Chain');
            } else {
                alert('Red no soportada.');
            }
        }

        // Función para comprar tokens
        async function buyTokens(amount, referrer) {
            document.getElementById('statusMessage').innerText = 'Procesando...';

            try {
                const contract = new web3.eth.Contract(abi, contractAddress);

                // Si el pago es en USDT, interactuar con el contrato de USDT
                if (selectedNetwork === 'binance') {
                    const usdtContractAddress = '0x55d398326f99059fF775485246999027B3197955'; // USDT en BSC
                    const usdtContract = new web3.eth.Contract(erc20ABI, usdtContractAddress);

                    await usdtContract.methods.approve(contractAddress, web3.utils.toWei(amount, 'mwei')).send({ from: currentAccount });

                    await contract.methods.buyTokensWithUSDT(amount, referrer || '0x0000000000000000000000000000000000000000').send({
                        from: currentAccount
                    });
                } else {
                    await contract.methods.buyTokens(amount, referrer || '0x0000000000000000000000000000000000000000').send({
                        from: currentAccount,
                        value: web3.utils.toWei(amount, 'ether')
                    });
                }

                document.getElementById('statusMessage').innerText = 'Compra exitosa!';
            } catch (error) {
                console.error(error);
                document.getElementById('statusMessage').innerText = 'Error en la compra.';
            }
        }

        // Función para iniciar la cuenta regresiva
        function startCountdown() {
            const countdownDate = new Date().getTime() + (30 * 60 * 1000); // 30 minutos

            const interval = setInterval(function () {
                const now = new Date().getTime();
                const distance = countdownDate - now;

                if (distance < 0) {
                    clearInterval(interval);
                    document.getElementById('timer').innerText = "La etapa ha terminado";
                } else {
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    document.getElementById('timer').innerText = `${minutes}m ${seconds}s`;
                }
            }, 1000);
        }

        // Inicializar funciones
        startCountdown();
        connectToNetwork();
    </script>
</body>
</html>
